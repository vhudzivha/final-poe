@model List<CMCS.Models.Claim>
@{
    ViewData["Title"] = "Pre-Approve Claims";
}

<div class="row">
    <div class="col-12">
        <h2 class="mb-4" style="color: white; font-weight: bold;">Claims Pending Pre-Approval</h2>
        <p style="color: #f8f9fa;">Programme Coordinator Review Dashboard</p>
    </div>
</div>

<div class="row">
    <div class="col-12">
        <div class="card-custom">
            <div class="card-header" style="background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%); color: white; padding: 15px; border-radius: 15px 15px 0 0;">
                <h5 class="mb-0">Submitted Claims Requiring Review</h5>
            </div>
            <div class="card-body p-0">
                <div class="table-responsive">
                    <table class="table table-hover mb-0">
                        <thead style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white;">
                            <tr>
                                <th scope="col">Claim ID</th>
                                <th scope="col">Lecturer Name</th>
                                <th scope="col">Period</th>
                                <th scope="col">Module</th>
                                <th scope="col">Hours</th>
                                <th scope="col">Rate</th>
                                <th scope="col">Amount</th>
                                <th scope="col">Submitted</th>
                                <th scope="col">Actions</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td><strong>CM-2024-12</strong></td>
                                <td>John Smith</td>
                                <td>March 2024</td>
                                <td>PROG6212</td>
                                <td>45</td>
                                <td>R100.00</td>
                                <td>R4,500.00</td>
                                <td>2024-03-15</td>
                                <td>
                                    <button class="btn btn-success btn-sm me-1 btn-preapprove" data-claim-id="CM-2024-12">Pre-Approve</button>
                                    <button class="btn btn-danger btn-sm btn-reject" data-claim-id="CM-2024-12">Reject</button>
                                </td>
                            </tr>
                            <tr>
                                <td><strong>CM-2024-13</strong></td>
                                <td>Mary Johnson</td>
                                <td>March 2024</td>
                                <td>PROG5121</td>
                                <td>38</td>
                                <td>R100.00</td>
                                <td>R3,800.00</td>
                                <td>2024-03-16</td>
                                <td>
                                    <button class="btn btn-success btn-sm me-1 btn-preapprove" data-claim-id="CM-2024-13">Pre-Approve</button>
                                    <button class="btn btn-danger btn-sm btn-reject" data-claim-id="CM-2024-13">Reject</button>
                                </td>
                            </tr>
                            <tr>
                                <td><strong>CM-2024-14</strong></td>
                                <td>David Wilson</td>
                                <td>March 2024</td>
                                <td>PROG6212</td>
                                <td>42</td>
                                <td>R100.00</td>
                                <td>R4,200.00</td>
                                <td>2024-03-17</td>
                                <td>
                                    <button class="btn btn-success btn-sm me-1 btn-preapprove" data-claim-id="CM-2024-14">Pre-Approve</button>
                                    <button class="btn btn-danger btn-sm btn-reject" data-claim-id="CM-2024-14">Reject</button>
                                </td>
                            </tr>
                            <tr>
                                <td><strong>CM-2024-15</strong></td>
                                <td>Lisa Brown</td>
                                <td>March 2024</td>
                                <td>PROG5121</td>
                                <td>48</td>
                                <td>R100.00</td>
                                <td>R4,800.00</td>
                                <td>2024-03-18</td>
                                <td>
                                    <button class="btn btn-success btn-sm me-1 btn-preapprove" data-claim-id="CM-2024-15">Pre-Approve</button>
                                    <button class="btn btn-danger btn-sm btn-reject" data-claim-id="CM-2024-15">Reject</button>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
</div>

<div class="row mt-4">
    <div class="col-md-3">
        <div class="card-custom text-center p-3">
            <h6 class="text-warning">Pending Review</h6>
            <h2 class="mb-0">4</h2>
        </div>
    </div>
    <div class="col-md-3">
        <div class="card-custom text-center p-3">
            <h6 class="text-success">Pre-Approved Today</h6>
            <h2 class="mb-0">3</h2>
        </div>
    </div>
    <div class="col-md-3">
        <div class="card-custom text-center p-3">
            <h6 class="text-danger">Rejected Today</h6>
            <h2 class="mb-0">1</h2>
        </div>
    </div>
    <div class="col-md-3">
        <div class="card-custom text-center p-3">
            <h6 class="text-info">Total Amount</h6>
            <h2 class="mb-0">R17,300</h2>
        </div>
    </div>
</div>

<!-- Pre-Approval Modal -->
<div class="modal fade" id="preApprovalModal" tabindex="-1">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header" style="background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%); color: white;">
                <h5 class="modal-title">Pre-Approve Claim</h5>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <p>Are you sure you want to pre-approve claim <strong id="approveClaimId"></strong>?</p>
                <div class="mb-3">
                    <label class="form-label">Comments (Optional):</label>
                    <textarea class="form-control" rows="3" id="approveComments" placeholder="Add any comments for the Academic Manager..."></textarea>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                <button type="button" class="btn btn-success" id="confirmPreApprove">Pre-Approve</button>
            </div>
        </div>
    </div>
</div>

<!-- Rejection Modal -->
<div class="modal fade" id="rejectionModal" tabindex="-1">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header bg-danger text-white">
                <h5 class="modal-title">Reject Claim</h5>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <p>Are you sure you want to reject claim <strong id="rejectClaimId"></strong>?</p>
                <div class="mb-3">
                    <label class="form-label">Reason for Rejection <span class="text-danger">*</span>:</label>
                    <textarea class="form-control" rows="3" id="rejectReason" placeholder="Please provide a reason for rejection..." required></textarea>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                <button type="button" class="btn btn-danger" id="confirmReject">Reject Claim</button>
            </div>
        </div>
    </div>
</div>

@section Scripts {
    <script>
        $(document).ready(function() {
            var currentClaimId = '';

            // Pre-approve button click
            $('.btn-preapprove').click(function() {
                currentClaimId = $(this).data('claim-id');
                $('#approveClaimId').text(currentClaimId);
                $('#preApprovalModal').modal('show');
            });

            // Reject button click
            $('.btn-reject').click(function() {
                currentClaimId = $(this).data('claim-id');
                $('#rejectClaimId').text(currentClaimId);
                $('#rejectionModal').modal('show');
            });

            // Confirm pre-approval
            $('#confirmPreApprove').click(function() {
                var comments = $('#approveComments').val();
                alert('Claim ' + currentClaimId + ' has been pre-approved and sent to Academic Manager.' +
                      (comments ? '\nComments: ' + comments : ''));
                $('#preApprovalModal').modal('hide');
                $('button[data-claim-id="' + currentClaimId + '"]').closest('tr').fadeOut();
            });

            // Confirm rejection
            $('#confirmReject').click(function() {
                var reason = $('#rejectReason').val();
                if (!reason.trim()) {
                    alert('Please provide a reason for rejection.');
                    return;
                }

                alert('Claim ' + currentClaimId + ' has been rejected.\nReason: ' + reason);
                $('#rejectionModal').modal('hide');
                $('button[data-claim-id="' + currentClaimId + '"]').closest('tr').fadeOut();
                $('#rejectReason').val('');
            });
        });
    </script>
}